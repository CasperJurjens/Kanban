<!doctype html>
<html>
<head>
    <meta charset="utf-8" />
    <!--<link rel="stylesheet" href="/css/base.css">-->
    <style>
        /*
        input.toggle:checked ~ div.view label {
            color: #d9d9d9;
            text-decoration: line-through;
        }
        li.slip-reordering {
            box-shadow: 0 2px 10px rgba(0,0,0,0.45);
            background-color: white;
        }
        */
        html {
            /*font: 14px 'Helvetica Neue', Helvetica, Arial, sans-serif;*/ /* normaal*/
            /*font-family: f-barlow, sans-serif;*/ /*normaal*/
            font-family: "apercu",sans-serif;
            font-size: 12px;
            color: #37392E; /*#C5C6C7*/
            height: 100%;
            width: 100%;
        }
        /*
        body {
            background: #f8f9fb;
        }
        */
        body {
            /*background-color: #0B0C10;*/
            background-color: #add869;
            
            /*background: rgb(11,12,16);*/
            /*background: linear-gradient(356deg, #EEE5E5 0%, #ad9f9e 55%);*/
            /*background: linear-gradient(356deg, rgb(146, 145, 184) 10%,  #cfbbb9 40%);*/
            background-repeat: no-repeat;
            background-size: 100% 100%;
        }
        h1 {
            text-decoration: none;
            margin:5px;
            font-size: 13px;
            font-weight:550;
        }

        a {
            text-decoration: none;
            color: black;
        }
        button {
            text-decoration: none;
            border: none;
        }
        li {
            text-decoration: none;  
            list-style: none; 
        }
        ul {
            text-decoration: none;
            list-style: none; 
        }
        .kanbanApp {
            position: relative;
            display: block;
            
            height: fit-content;
        }
        * {
            box-sizing: border-box;
        }
        .headercontainer {
            position: fixed;
            padding: 5px;
            margin: 0;
            margin-bottom: 40px;
            top: 0;
            left: 0;
            width: 100%;
            background-color: rgba(99, 99, 99, 0.466);
        }
        .header {
            position: relative;
            width: 70em;
            top:0px;
            /*background: #EAEDF0;*/
            color:#37392E;
            padding: 2px;
            margin: auto;
        }
        .main  {
            position: relative;
            top: 4em;
        }
        .lists {
            /*background-color: green;*/
            display: flex;
            flex-direction: row;
            flex-wrap: nowrap;
            list-style: none;
                        
        }
        .addlistcontainer {
            position: relative;
            order: 10000;
            flex-shrink: 0;
            align-content: flex-start;
            
            list-style: none;
            flex-wrap: nowrap;
            flex-grow: initial;
            /*background-color: #EAEDF0; */ /*normaal*/
            background-color: #fafafa5d;
            width: 20em;
            height: fit-content;
            padding: 4px;
            margin: 10px;
            border-radius: 4%;
        }
        .newlisttitle {

        }
        .list {
            position: relative;
            width: 20em;
            height: fit-content;
            padding: 4px;
            margin: 10px;
            border-radius: 4%;
            
            list-style: none;
            /*background-color: #EAEDF0; */ /*normaal*/
            background-color: #fafafa5d;
        }
        .items {
            display: flex;
            flex-direction: column;
            padding: 0;
        }
        .addItemContainer {
            order: 10000;                       /* dit werkt om het probleem heen en moet wss vervangen worden*/
            position: relative;
            list-style: none;
            width: 18em;
            /*background-color: white;*/
            background-color: #EEE5E5;
            padding: 5px;
            box-shadow: 1px 1px 3px #5e5e5e8e;
            margin: 6px;
        }
        .item {
            position: relative;
            list-style: none;
            width: 18em;
            /*background-color: white;*/
            background-color: #EEE5E5;
            padding: 5px;
            box-shadow: 1px 1px 3px #5e5e5e8e;
            margin: 6px;
            
        }
        .listtitle {
            min-height: 20px;
            overflow :hidden;
            white-space: nowrap;
        }
        .text {
            min-height: 20px;
        }
        .menu {
            position: absolute;
            display: block;
            right: 0px;
            top: 0px;
            height: 15px;
            width: fit-content;
            padding: 5px 6px 7px 30px;
        }
        #listmenu.menu {
            /*background: linear-gradient(to right, #EAEDF000, #EAEDF0 10px);*/
            border-radius: 4px;
            background: linear-gradient(to right, #869e5f00, #c9e49e 10px);
           
        }
        .teaser {
            right: 3px;
            top: 5px;
            padding: 0 3px;
        }
        .menucontent {
            display: none;
            vertical-align: top;
            z-index: -1;
        }
        
        .menu:hover .menucontent{
            display: inline-block;
        }
        .menu:hover .teaser{
            display: none;
        }
        .edit {
            display: none;
        }
        .refer-back {
            text-align: center;
            margin: 5em; 
        }
        .refer-back a{
            text-decoration:underline;
        }
    </style>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/slipjs/2.0.0/slip.min.js"></script> <!-- Wat doet dit precies?? -->
</head>
<body>
    <section class="kanbanApp">
        <div>
            <div class="headercontainer">
                <header class="header">
                    <h1> Welcome to KanbanBoard </h1>
                    <div class="menu">
                        <a href="#" class="teaser">≡</a>
                        <div class="menucontent">
                            <button class="dellist" data-simply-command=""> del list </button>
                            <button class="movelist" data-simply-command=""> move list </button>
                            <button class="additem" data-simply-command="addlist"> add list </button>
                        </div>
                    </div>
                </header>
            </div>

            <section class="main">
                <ul class="lists" data-simply-list="kanban">
                    <template>
                        <li class="list">
                            <span class="listorder" data-simply-field="data.order">0</span>
                            <input class="pathInput" data-simply-field="path" /> <!-- type="hidden" -->
                            <div class="head">
                                <h1 class="listtitle" data-simply-field="data.listtitle">List Title</h1>
                                <div id="listmenu" class="menu">
                                    <a href="#" class="teaser">≡</a>
                                    <div id="listmenucontent" class="menucontent">
                                        <button class="dellist" data-simply-command="dellist"> del list </button>
                                        <button class="additem" data-simply-command=""> add note </button>
                                    </div>
                                </div>
                            </div>
                            
                            
                            <ul class="items" data-simply-list="items">
                                <template>
                                    <li class="item">
                                        <div id="itemmenu" class="menu">
                                            <a href="#" class="teaser">≡</a>
                                            <div id="itemmenucontent" class="menucontent">
                                                <button class="delitem" data-simply-command=""> del item </button>
                                                <button class="movelist" data-simply-command=""> raw </button>
                                                <button class="colitem" data-simply-command=""> collapse </button>
                                            </div>
                                        </div>
                                        <div class="text" data-simply-field="title">
                                            title
                                        </div>
                                        <div class="text" data-simply-field="data.description">
                                            Description
                                        </div>
                                        <textarea class="edit"> </textarea>
                                    </li>
                                </template>

                                <li class="addItemContainer">
                                    <form id="form" data-simply-command="additem">
                                        <input class="new-item" type="text" name="newItem" placeholder="What needs to be done?">
                                    </form>
                                </li>

                            </ul>
                        </li>
                    </template>

                    <li class="addlistcontainer">
                        <form id="form" data-simply-command="addlist">
                            <input class="new-kanban" type="text" name="newList" placeholder="What needs to be done?">
                        </form>
                    </li>

                </ul>
            </section>
            
        </div>
    </section>
    <p class="refer-back">This example is part of <a href="https://simplyedit.io/examples/" target="_blank">simplyedit.io/examples/</a>






    <!--
    <section class="kanbanapp">
        <div>
            <header class="header">
                <h1>kanbans</h1>
                <form id="form" data-simply-command="addkanban">
                    <input class="new-kanban" type="text" name="newItem" placeholder="What needs to be done?">
                </form>
            </header>
            <section class="main">
                <ul class="kanban-list" data-simply-list="kanban">                                                  Hier herkent ie de view.kanban 
                    <template>
                        <li>
                            <span data-simply-field="data.order">0</span>
                            <input class="pathInput" data-simply-field="path" type="hidden" />
                            <input type="checkbox" class="toggle" data-simply-field="completed" value="1">
                            <div class="view">
                                <label data-simply-field="data.item">Item</label>
                                <button class="edit" data-simply-command="editkanban"></button>
                                <button class="destroy" data-simply-command="delkanban"></button>
                            </div>
                            <input class="edit" data-simply-field="data.item" type="text">                  data-simply-command="showkanban" 
                        </li>
                    </template>
                </ul>
            </section>
            <footer class="footer">
                <span class="kanban-count" data-simply-field="count" data-simply-content="template" data-simply-default-template="other">
                    Nothing left kanban!                                                                                                      Dit doet het niet tijdens eerste keer laden v pagina
                    <template data-simply-template="0">Nothing left kanban!</template>
                    <template data-simply-template="1"><strong>1</strong> item left</template>
                    <template data-simply-template="other"><strong data-simply-field="count">n</strong> items left</template>
                </span>
            </footer>
        </div>
    </section>
-->


    <script src="https://unpkg.com/simplyview@2.0.1/dist/simply.everything.js"></script>
    <script src="https://cdn.simplyedit.io/1/simply-edit.js"></script>
    

    <script>
        const api = simply.api.proxy({
            baseURL:'http://backend.local/',
            paramsFormat:'json',
            responseFormat:'json',
            mode:'cors',
            verbs: ['get','post','put','patch','delete']
        });
        

        //Zorg dat het in juiste volgorde opgevraagd / afgebeeld word 
        api.get().then(function (node) {
            kanbanApp.view.kanban = Object.values(node.nodes);
            kanbanApp.view.kanban.sort(function (a, b) {
                return a.data.order - b.data.order;
            });
            console.log(Object.values(node.nodes));
        });

           
        var kanbanApp = simply.app({

            commands: { 
            
                additem: function (form, values) {
                    //Geef hoogste volgorde waarde
                    var targList = form.closest('li').parentElement.parentElement;
                    
                    var listIndex = targList.querySelector('.listorder').innerHTML - 1;

                    if (values.newItem.trim()) {
                        var orderNum = 1;
                        if (kanbanApp.view.kanban[listIndex].length != null) { //Index nodig
                            orderNum = kanbanApp.view.kanban[listIndex].items.length + 1;
                        } else {
                            orderNum = 1 ;
                        }

                        var kanbanItem = {
                            items: {
                                item: values.newItem.trim(),
                                order: orderNum
                            }
                        };
                        var path = targList.querySelector('.pathInput').value;
                        
                        api[path].patch(kanbanItem).then(function (response) {
                            console.log(response);
                            
                            /*path = response.replace('/', '');*/
                            return api[path].items[orderNum - 1].get();
                            
                        }).then(function (response) { 
                            console.log(response); 
                            kanbanApp.view.kanban[listIndex].items.push(response.node); 
                            console.log(kanbanApp.view.kanban);
                        });
                    }
                    form.newItem.value = '';

                },
                addlist: function (form, values) {
                    //Geef hoogste volgorde waarde

                    if (values.newList.trim()) {
                        var orderNum = 1;
                        if (kanbanApp.view.count != null) {
                            orderNum = kanbanApp.view.kanban.length + 1;
                        } else {
                            orderNum = 1;
                        }

                        var kanbanList = {
                            listtitle: values.newList.trim(),
                            items: [],
                            order: orderNum
                        };
                        var path;
                        api.post(kanbanList).then(function (response) {
                            console.log(response);
                            path = response.replace('/', '');
                            return api[path].get();
                        })
                            .then(function (response) { console.log(response); kanbanApp.view.kanban.push(response.node); console.log(kanbanApp.view.kanban);});
                    }
                    form.newList.value = '';

                },
                
                dellist: function (el, value) {
                    var delPathUncut = el.closest('li').querySelector('.pathInput').value;
                    //var delPathUncut = el.parentElement.parentElement.parentElement.parentElement.querySelector('.pathInput').value
                    var delPath = delPathUncut.replace('/', '');
                    console.log('delPath = ' + delPath);
                    api[delPath].delete().then(function (response) { console.log("delete response: "); console.log(response); });

                    el.closest('li').remove();
                    console.log('volgende log is view.kanban: ');
                    console.log(kanbanApp.view.kanban);
                    if (kanbanApp.view.kanban.length != 0) {
                        kanbanApp.view.kanban.forEach(function (item, index) {
                                item.data.order = index + 1;
                                api[item.path.replace('/', '')].patch({ order: index + 1 }).then(function (response) { console.log(response); });      //Zorgt voor error maar doet het wel
                                
                            }
                        )
                    }
                }/*,
                
                editkanban: function (ele, value) {
                    var itemLiPre = ele.closest('li');
                    var input = itemLiPre.querySelector('input[type="text"]');

                    itemLiPre.classList.add('editing');
                    input.focus();
                    
                    input.addEventListener('blur', function () {
                        input.removeEventListener('keyup', keyEscape);
                        kanbanApp.commands.call('showkanban', input, itemLiPre);
                    }, { once: true });
                    
                    var keyEscape = function(evt) {
                        if (["Escape","Cancel"].indexOf(evt.key)!=-1) {
                            input.value = itemLiPre.querySelector('label[data-simply-field="data.item"]').innerHTML;
                        }
                        if (["Escape","Cancel","Enter"].indexOf(evt.key)!=-1) {
                            kanbanApp.commands.call('showkanban', input, itemLiPre);
                        }
                    };
                    input.addEventListener('keyup', keyEscape);
                },
                showkanban: function(elem, itemLi, value) {
                    elem.closest('li').classList.remove('editing');
                    elem.blur();
                    
                    console.log('itemLi = ' + itemLi);
                    var patchPathUncut = itemLi.querySelector('.pathInput').value;                   //Krijg hier een error, maar het werkt wel...
                    var patchPath = patchPathUncut.replace('/', '');
                    var patchItem = {
                        item: elem.value,
                        completed: 0
                    };
                    api[patchPath].patch(patchItem).then(function (response) { console.log('patch response: ' + response); }); //Test database update
                }
                */
            },
            view: {
                /*
                kanban: [
                {
                    listtitle: 'Todo en een hele lange titel test test test test test test test',
                    items: [
                        {
                            title: 'Een todo item',
                            description: 'Een langere omschrijving'
                        },
                        {
                            title: 'Nog een todo item',
                            description: 'Een langere omschrijving'
                        },
                        {
                            title: 'Nog een todo item',
                            description: 'Een langere omschrijving'
                        },
                        {
                            title: 'Nog een todo item',
                            description: 'Een langere omschrijving'
                        }
                    ]
                },
                {
                    listtitle: 'Doing',
                    items: [
                        {
                            title: 'Een todo item waar aan gewerkt wordt',
                            description: 'Een langere omschrijving'
                        }
                    ]
                },
                {
                    listtitle: 'Todo en een hele lange titel test test test test test test test',
                    items: [
                        {
                            title: 'Een todo item',
                            description: 'Een langere omschrijving'
                        },
                        {
                            title: 'Nog een todo item',
                            description: 'Een langere omschrijving'
                        }
                    ]
                },
                {
                    listtitle: 'Doing',
                    items: [
                        {
                            title: 'Een todo item waar aan gewerkt wordt',
                            description: 'Een langere omschrijving'
                        }
                    ]
                },
                {
                    listtitle: 'Todo en een hele lange titel test test test test test test test',
                    items: [
                        {
                            title: 'Een todo item',
                            description: 'Een langere omschrijving'
                        },
                        {
                            title: 'Nog een todo item',
                            description: 'Een langere omschrijving'
                        }
                    ]
                },
                {
                    listtitle: 'Doing',
                    items: [
                        {
                            title: 'Een todo item waar aan gewerkt wordt',
                            description: 'Een langere omschrijving'
                        }
                    ]
                },
                {
                    listtitle: 'Todo en een hele lange titel test test test test test test test',
                    items: [
                        {
                            title: 'Een todo item',
                            description: 'Een langere omschrijving'
                        },
                        {
                            title: 'Nog een todo item',
                            description: 'Een langere omschrijving'
                        },
                        {
                            title: 'Nog een todo item',
                            description: 'Een langere omschrijving'
                        },
                        {
                            title: 'Nog een todo item',
                            description: 'Een langere omschrijving'
                        }
                    ]
                }
                               
                ]
                */
            }
            
            
        });
        /*
        kanbanApp.view.kanban = [
            {
                listtitle: 'Todo',
                items: [
                    {
                        title: 'Een todo item',
                        description: 'Een langere omschrijving'
                    },
                    {
                        title: 'Nog een todo item',
                        description: 'Een langere omschrijving'
                    }
                ]
            },
            {
                listtitle: 'Doing',
                items: [
                    {
                        title: 'Een todo item waar aan gewerkt wordt',
                        description: 'Een langere omschrijving'
                    }
                ]
            }
        ];
        */
        


        /*
        // 3: update the counter whenever the list changes
        document.addEventListener('simply-data-changed', function(evt) {
            if (evt.data.arguments[0] == 'kanban') {
                if (kanbanApp.view.kanban.length != null) {
                    kanbanApp.view.count = kanbanApp.view.kanban.length;
                } else {
                    kanbanApp.view.count = 0;
                }
            }
        });

        // 6: drag and drop items to reorder them
        var kanbanList = document.querySelector('ul.kanban-list');
        
        kanbanList.addEventListener('slip:reorder', function (e) {
            e.target.parentNode.insertBefore(e.target, e.detail.insertBefore);
            
            if (kanbanApp.view.kanban.length != 0) {
                kanbanApp.view.kanban.forEach(function (item, index) {
                    api[item.path.replace('/', '')].patch({ order: index + 1 }).then(function (response) { console.log(response); });      //Zorgt voor error maar doet het wel
                    item.data.order = index + 1;
                }
                )
            }
            
            console.log(kanbanApp.view.kanban);
        });

        // 7: swipe to remove an item
        kanbanList.addEventListener('slip:swipe', function(e) {
            var delItem = e.target;
            //delItem.parentNode.removeChild(delItem);      //Eerst parent en dan weer child is toch onnodige extra stap?
            delItem.remove();
            var delPathUncut = delItem.closest('li').querySelector('.pathInput').value;
            var delPath = delPathUncut.replace('/', '');
            api[delPath].delete().then(function (response) { console.log(response); });
        });

        new Slip(kanbanList);
        */

    </script>
</body>
</html>